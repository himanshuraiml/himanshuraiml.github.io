<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <link rel="stylesheet" href="/admin/preview-styles.css" />
</head>
<body>
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }

    var BlogPostPreview = createClass({
      render: function() {
        var entry = this.props.entry;
        var title = entry.getIn(['data', 'title']) || 'Untitled';
        var date = entry.getIn(['data', 'date']);
        var author = entry.getIn(['data', 'author']) || 'Dr. Himanshu Rai';
        var coverImage = entry.getIn(['data', 'coverImage']);
        var tags = entry.getIn(['data', 'tags']);
        var body = this.props.widgetFor('body');

        var tagList = tags ? tags.toJS() : [];

        var formattedDate = date ? new Date(date).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        }) : 'No date';

        var wordCount = entry.getIn(['data', 'body']) ? entry.getIn(['data', 'body']).split(/\s+/).length : 0;
        var readTime = Math.ceil(wordCount / 200);

        return h('div', {className: 'preview-container'},
          h('div', {className: 'preview-header'},
            h('span', {className: 'preview-badge'}, 'PREVIEW MODE'),
            h('span', {className: 'preview-info'}, readTime + ' min read')
          ),

          h('article', {className: 'preview-article'},
            coverImage && h('div', {className: 'preview-cover-wrapper'},
              h('img', {
                src: this.props.getAsset(coverImage).toString(),
                alt: title,
                className: 'preview-cover-image'
              })
            ),

            h('div', {className: 'preview-meta'},
              h('div', {className: 'preview-tags-row'},
                tagList.slice(0, 2).map(function(tag, index) {
                  return h('span', {key: index, className: 'preview-tag'},
                    h('svg', {
                      className: 'preview-tag-icon',
                      fill: 'none',
                      stroke: 'currentColor',
                      viewBox: '0 0 24 24',
                      width: 14,
                      height: 14
                    },
                      h('path', {
                        strokeLinecap: 'round',
                        strokeLinejoin: 'round',
                        strokeWidth: 2,
                        d: 'M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z'
                      })
                    ),
                    tag
                  );
                }),
                h('span', {className: 'preview-meta-item'},
                  h('svg', {
                    className: 'preview-meta-icon',
                    fill: 'none',
                    stroke: 'currentColor',
                    viewBox: '0 0 24 24',
                    width: 16,
                    height: 16
                  },
                    h('path', {
                      strokeLinecap: 'round',
                      strokeLinejoin: 'round',
                      strokeWidth: 2,
                      d: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'
                    })
                  ),
                  formattedDate
                ),
                h('span', {className: 'preview-meta-item'},
                  h('svg', {
                    className: 'preview-meta-icon',
                    fill: 'none',
                    stroke: 'currentColor',
                    viewBox: '0 0 24 24',
                    width: 16,
                    height: 16
                  },
                    h('path', {
                      strokeLinecap: 'round',
                      strokeLinejoin: 'round',
                      strokeWidth: 2,
                      d: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z'
                    })
                  ),
                  readTime + ' min read'
                ),
                h('span', {className: 'preview-meta-item'},
                  h('svg', {
                    className: 'preview-meta-icon',
                    fill: 'none',
                    stroke: 'currentColor',
                    viewBox: '0 0 24 24',
                    width: 16,
                    height: 16
                  },
                    h('path', {
                      strokeLinecap: 'round',
                      strokeLinejoin: 'round',
                      strokeWidth: 2,
                      d: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'
                    })
                  ),
                  author
                )
              ),

              h('h1', {className: 'preview-title'}, title),

              tagList.length > 2 && h('div', {className: 'preview-extra-tags'},
                tagList.slice(2).map(function(tag, index) {
                  return h('span', {key: index, className: 'preview-extra-tag'}, tag);
                })
              )
            ),

            h('div', {className: 'preview-content prose'}, body),

            h('div', {className: 'preview-author-bio'},
              h('div', {className: 'preview-author-avatar'},
                h('img', {src: '/image.png', alt: author})
              ),
              h('div', {className: 'preview-author-info'},
                h('h4', {}, 'About the Author'),
                h('p', {}, 'Dr. Himanshu Rai is an Assistant Professor in Computer Science & Engineering at SRM Institute of Science and Technology, specializing in Machine Learning, Artificial Intelligence, and Data Science.')
              )
            )
          )
        );
      }
    });

    CMS.registerPreviewTemplate('blog', BlogPostPreview);
  </script>
</body>
</html>
